<!DOCTYPE HTML>
<html lang>
<head>
<!-- Generated by javadoc (21) on Sun Aug 11 07:27:12 UTC 2024 -->
<title>SecurityUtils (Javadoc)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="dc.created" content="2024-08-11">
<meta name="description" content="declaration: package: eu.righettod, class: SecurityUtils">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../script-dir/jquery-ui.min.css" title="Style">
<script type="text/javascript" src="../../script.js"></script>
<script type="text/javascript" src="../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/SecurityUtils.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../index-all.html">Index</a></li>
<li><a href="../../help-doc.html#class">Help</a></li>
</ul>
<ul class="sub-nav-list-small">
<li>
<p>Summary:</p>
<ul>
<li>Nested</li>
<li>Field</li>
<li>Constr</li>
<li><a href="#method-summary">Method</a></li>
</ul>
</li>
<li>
<p>Detail:</p>
<ul>
<li>Field</li>
<li>Constr</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</li>
</ul>
</div>
<div class="sub-nav">
<div id="navbar-sub-list">
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><a href="../../search.html">SEARCH</a>
<input type="text" id="search-input" disabled placeholder="Search">
<input type="reset" id="reset-button" disabled value="reset">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">eu.righettod</a></div>
<h1 title="Class SecurityUtils" class="title">Class SecurityUtils</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">eu.righettod.SecurityUtils</div>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-70">SecurityUtils</a></span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span></div>
<div class="block">Provides different utilities methods to apply processing from a security perspective.<br>
 These code snippet:
 <ul>
     <li>Can be used, as "foundation", to customize the validation to the app context.</li>
     <li>Were implemented in a way to facilitate adding or removal of validations depending on usage context.</li>
     <li>Were centralized on one class to be able to enhance them across time as well as <a href="https://github.com/righettod/code-snippets-security-utils/issues">missing case/bug identification</a>.</li>
 </ul></div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab1" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab1', 3)" class="table-tab">Static Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel" aria-labelledby="method-summary-table-tab0">
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#clearPDFMetadata(org.apache.pdfbox.pdmodel.PDDocument)" class="member-name-link">clearPDFMetadata</a><wbr>(org.apache.pdfbox.pdmodel.PDDocument&nbsp;document)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Remove as much as possible metadata from the provided PDF document object.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static byte[]</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#computeHashNoProneToAbuseOnParts(java.util.List)" class="member-name-link">computeHashNoProneToAbuseOnParts</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;&nbsp;parts)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Compute a SHA256 hash from an input composed of a collection of strings.<br><br>
 This method take care to build the source string in a way to prevent this source string to be prone to abuse targeting the different parts composing it.<br><br>
 Example of possible abuse without precautions applied during the hash calculation logic:<br>
 Hash of <code>SHA256("Hello", "My", "World!!!")</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a><wbr>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#ensureSerializedObjectIntegrity(eu.righettod.ProcessingMode,java.lang.String,byte%5B%5D)" class="member-name-link">ensureSerializedObjectIntegrity</a><wbr>(<a href="ProcessingMode.html" title="enum class in eu.righettod">ProcessingMode</a>&nbsp;processingMode,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;input,
 byte[]&nbsp;secret)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Provide a way to add an integrity marker (<a href="https://en.wikipedia.org/wiki/HMAC">HMAC</a>) to a serialized object serialized using the <a href="https://www.baeldung.com/java-serialization">java native system</a> (binary).<br>
 The goal is to provide <b>a temporary workaround</b> to try to prevent deserialization attacks and give time to move to a text-based serialization approach.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a><wbr>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/net/URL.html" title="class or interface in java.net" class="external-link">URL</a>&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#extractAllPDFLinks(java.lang.String)" class="member-name-link">extractAllPDFLinks</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;pdfFilePath)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Extract all URL links from a PDF file provided.<br>
 This can be used to apply validation on a PDF against contained links.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#identifyMimeType(byte%5B%5D)" class="member-name-link">identifyMimeType</a><wbr>(byte[]&nbsp;content)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Identify the mime type of the content specified (array of bytes).<br>
 Note that it cannot be fully trusted (see the tweet '1595824709186519041' referenced), so, additional validations are required.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isEmailAddress(java.lang.String)" class="member-name-link">isEmailAddress</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;addr)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Apply a collection of validations on a string expected to be an email address:<br>
 - Is a valid email address, from a parser perspective, following RFCs on email addresses.<br>
 - Is not using "Encoded-word" format.<br>
 - Is not using comment format.<br>
 - Is not using "Punycode" format.<br>
 - Is not using UUCP style addresses.<br>
 - Is not using address literals.<br>
 - Is not using source routes.<br>
 - Is not using the "percent hack".<br><br>
 This is based on the research work from <a href="https://portswigger.net/research/gareth-heyes">Gareth Heyes</a> added in references (Portswigger).<br><br>

 <b>Note:</b> The notion of valid, here, is to take from a secure usage of the data perspective.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isExcelCSVSafe(java.lang.String)" class="member-name-link">isExcelCSVSafe</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;csvFilePath)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Apply a collection of validations on a EXCEL CSV file provided (file was expected to be opened in Microsoft EXCEL):<br>
 - Real CSV file.<br>
 - Do not contains any payload related to a CSV injections.<br><br>
 Ensure that, if Apache Commons CSV does not find any record then, the file will be considered as NOT safe (prevent potential bypasses).<br><br>
 <b>Note:</b> Record delimiter used is the <code>,</code> (comma) character.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isImageSafe(java.lang.String,java.util.List)" class="member-name-link">isImageSafe</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;imageFilePath,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;&nbsp;imageAllowedMimeTypes)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Apply a collection of validations on a image file provided:<br>
 - Real image file.<br>
 - Its mime type is into the list of allowed mime types.<br>
 - Its metadata fields do not contains any characters related to a malicious payloads.<br>

 <br>
 <b>Important note:</b> This implementation is prone to bypass using the "<b>raw insertion</b>" method documented in the <a href="https://www.synacktiv.com/en/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there">blog post</a> from the Synacktiv team.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isJSONSafe(java.lang.String,int,int)" class="member-name-link">isJSONSafe</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;json,
 int&nbsp;maxItemsByArraysCount,
 int&nbsp;maxDeepnessAllowed)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Apply a collection of validations on a JSON string provided:<br>
 - Real JSON structure.<br>
 - Contain less than a specified number of deepness for nested objects or arrays.<br>
 - Contain less than a specified number of items in any arrays.<br><br>

 <b>Note:</b> I decided to use a parsing approach using only string processing to prevent any StackOverFlow or OutOfMemory error that can be abused.<br><br>
 I used the following assumption:
 
      The character <code>{</code> identify the beginning of an object.
      The character <code>}</code> identify the end of an object.
      The character <code>[</code> identify the beginning of an array.
      The character <code>]</code> identify the end of an array.
      The character <code>"</code> identify the delimiter of a string.
      The character sequence <code>\"</code> identify the escaping of an double quote.
 </div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isPDFSafe(java.lang.String)" class="member-name-link">isPDFSafe</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;pdfFilePath)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Apply a collection of validations on a PDF file provided:<br>
 - Real PDF file<br>
 - No attachments.<br>
 - No Javascript code.<br>
 - No links using action of type URI/Launch/RemoteGoTo/ImportData.<br></div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isPublicIPAddress(java.lang.String)" class="member-name-link">isPublicIPAddress</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;ip)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Apply a collection of validations on a string expected to be an public IP address:<br>
 - Is a valid IP v4 or v6 address.<br>
 - Is public from an Internet perspective.<br><br>
 <b>Note:</b> I often see missing such validation in the value read from HTTP request headers like "X-Forwarded-For" or "Forwarded".</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isRelativeURL(java.lang.String)" class="member-name-link">isRelativeURL</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;targetUrl)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Validate that the URL provided is really a relative URL.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isWeakPINCode(java.lang.String)" class="member-name-link">isWeakPINCode</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;pinCode)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Apply a collection of validation to verify if a provided PIN code is considered weak (easy to guess) or none.<br>
 This method consider that format of the PIN code is [0-9]{6,}<br>
 Rule to consider a PIN code as weak:<br>
 - Length is inferior to 6 positions.<br>
 - Contain only the same number or only a sequence of zero.<br>
 - Contain sequence of following incremental or decremental numbers.<br></div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isWord972003DocumentSafe(java.lang.String)" class="member-name-link">isWord972003DocumentSafe</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;wordFilePath)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Apply a collection of validations on a Word 97-2003 (binary format) document file provided:<br>
 - Real Microsoft Word 97-2003 document file.<br>
 - No VBA Macro.<br>
 - No embedded objects.<br></div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isXMLOnlyUseAllowedXSDorDTD(java.lang.String,java.util.List)" class="member-name-link">isXMLOnlyUseAllowedXSDorDTD</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;xmlFilePath,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;&nbsp;allowedSystemIdentifiers)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Ensure that an XML file only uses DTD/XSD references (called System Identifier) present in the allowed list provided.<br><br>
 The code is based on the validation implemented into the OpenJDK 21, by the class <b><a href="https://github.com/openjdk/jdk/blob/jdk-21%2B35/src/java.prefs/share/classes/java/util/prefs/XmlSupport.java">java.util.prefs.XmlSupport</a></b>, in the method <b><a href="https://github.com/openjdk/jdk/blob/jdk-21%2B35/src/java.prefs/share/classes/java/util/prefs/XmlSupport.java#L240">loadPrefsDoc()</a></b>.<br><br>
 The method also ensure that no Public Identifier is used to prevent potential bypasses of the validations.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static boolean</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isXMLSafe(java.lang.String)" class="member-name-link">isXMLSafe</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;xmlFilePath)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Ensure that an XML file does not contain any External Entity, DTD or XInclude instructions.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static boolean</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#isZIPSafe(java.lang.String,int,boolean)" class="member-name-link">isZIPSafe</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;zipFilePath,
 int&nbsp;maxLevelDeepness,
 boolean&nbsp;rejectArchiveFile)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Apply a collection of validations on a ZIP file provided:<br>
 - Real ZIP file<br>
 - Contain less than a specified level of deepness.<br>
 - Do not contain Zip-Slip entry path.<br></div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static byte[]</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#sanitizeFile(java.lang.String,eu.righettod.InputFileType)" class="member-name-link">sanitizeFile</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;inputFilePath,
 <a href="InputFileType.html" title="enum class in eu.righettod">InputFileType</a>&nbsp;inputFileType)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Rewrite the input file to remove any embedded files that is not embedded using a methods supported by the official format of the file.<br>
 Example: a file can be embedded by adding it to the end of the source file, see the reference provided for details.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="isWeakPINCode(java.lang.String)">
<h3>isWeakPINCode</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-89">isWeakPINCode</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;pinCode)</span></div>
<div class="block">Apply a collection of validation to verify if a provided PIN code is considered weak (easy to guess) or none.<br>
 This method consider that format of the PIN code is [0-9]{6,}<br>
 Rule to consider a PIN code as weak:<br>
 - Length is inferior to 6 positions.<br>
 - Contain only the same number or only a sequence of zero.<br>
 - Contain sequence of following incremental or decremental numbers.<br></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>pinCode</code> - PIN code to verify.</dd>
<dt>Returns:</dt>
<dd>True only if the PIN is considered as weak.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isWord972003DocumentSafe(java.lang.String)">
<h3>isWord972003DocumentSafe</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-135">isWord972003DocumentSafe</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;wordFilePath)</span></div>
<div class="block">Apply a collection of validations on a Word 97-2003 (binary format) document file provided:<br>
 - Real Microsoft Word 97-2003 document file.<br>
 - No VBA Macro.<br>
 - No embedded objects.<br></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>wordFilePath</code> - Filename of the Word document file to check.</dd>
<dt>Returns:</dt>
<dd>True only if the file pass all validations.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://poi.apache.org/components/"</li>
<li>"https://poi.apache.org/components/document/"</li>
<li>"https://poi.apache.org/components/poifs/how-to.html"</li>
<li>"https://poi.apache.org/components/poifs/embeded.html"</li>
<li>"https://poi.apache.org/"</li>
<li>"https://mvnrepository.com/artifact/org.apache.poi/poi"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isXMLSafe(java.lang.String)">
<h3>isXMLSafe</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-194">isXMLSafe</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;xmlFilePath)</span></div>
<div class="block">Ensure that an XML file does not contain any External Entity, DTD or XInclude instructions.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>xmlFilePath</code> - Filename of the XML file to check.</dd>
<dt>Returns:</dt>
<dd>True only if the file pass all validations.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://portswigger.net/web-security/xxe"</li>
<li>"https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java"</li>
<li>"https://docs.oracle.com/en/java/javase/13/security/java-api-xml-processing-jaxp-security-guide.html#GUID-82F8C206-F2DF-4204-9544-F96155B1D258"</li>
<li>"https://www.w3.org/TR/xinclude-11/"</li>
<li>"https://en.wikipedia.org/wiki/XInclude"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="extractAllPDFLinks(java.lang.String)">
<h3>extractAllPDFLinks</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/net/URL.html" title="class or interface in java.net" class="external-link">URL</a>&gt;</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-233">extractAllPDFLinks</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;pdfFilePath)</span>
                                    throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Exception.html" title="class or interface in java.lang" class="external-link">Exception</a></span></div>
<div class="block">Extract all URL links from a PDF file provided.<br>
 This can be used to apply validation on a PDF against contained links.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>pdfFilePath</code> - pdfFilePath Filename of the PDF file to process.</dd>
<dt>Returns:</dt>
<dd>A List of URL objects that is empty if no links is found.</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Exception.html" title="class or interface in java.lang" class="external-link">Exception</a></code> - If any error occurs during the processing of the PDF file.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://www.gushiciku.cn/pl/21KQ"</li>
<li>"https://pdfbox.apache.org/"</li>
<li>"https://mvnrepository.com/artifact/org.apache.pdfbox/pdfbox"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isPDFSafe(java.lang.String)">
<h3>isPDFSafe</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-284">isPDFSafe</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;pdfFilePath)</span></div>
<div class="block">Apply a collection of validations on a PDF file provided:<br>
 - Real PDF file<br>
 - No attachments.<br>
 - No Javascript code.<br>
 - No links using action of type URI/Launch/RemoteGoTo/ImportData.<br></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>pdfFilePath</code> - Filename of the PDF file to check.</dd>
<dt>Returns:</dt>
<dd>True only if the file pass all validations.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://stackoverflow.com/a/36161267"</li>
<li>"https://www.gushiciku.cn/pl/21KQ"</li>
<li>"https://github.com/jonaslejon/malicious-pdf"</li>
<li>"https://pdfbox.apache.org/"</li>
<li>"https://mvnrepository.com/artifact/org.apache.pdfbox/pdfbox"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="clearPDFMetadata(org.apache.pdfbox.pdmodel.PDDocument)">
<h3>clearPDFMetadata</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-341">clearPDFMetadata</a></span><wbr><span class="parameters">(org.apache.pdfbox.pdmodel.PDDocument&nbsp;document)</span></div>
<div class="block">Remove as much as possible metadata from the provided PDF document object.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>document</code> - PDFBox PDF document object on which metadata must be removed.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://gist.github.com/righettod/d7e07443c43d393a39de741a0d920069"</li>
<li>"https://pdfbox.apache.org/"</li>
<li>"https://mvnrepository.com/artifact/org.apache.pdfbox/pdfbox"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isRelativeURL(java.lang.String)">
<h3>isRelativeURL</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-359">isRelativeURL</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;targetUrl)</span></div>
<div class="block">Validate that the URL provided is really a relative URL.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>targetUrl</code> - URL to validate.</dd>
<dt>Returns:</dt>
<dd>True only if the file pass all validations.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://portswigger.net/web-security/ssrf"</li>
<li>"https://stackoverflow.com/q/6785442"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isZIPSafe(java.lang.String,int,boolean)">
<h3>isZIPSafe</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-396">isZIPSafe</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;zipFilePath,
 int&nbsp;maxLevelDeepness,
 boolean&nbsp;rejectArchiveFile)</span></div>
<div class="block">Apply a collection of validations on a ZIP file provided:<br>
 - Real ZIP file<br>
 - Contain less than a specified level of deepness.<br>
 - Do not contain Zip-Slip entry path.<br></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>zipFilePath</code> - Filename of the ZIP file to check.</dd>
<dd><code>maxLevelDeepness</code> - Threshold of deepness above which a ZIP archive will be rejected.</dd>
<dd><code>rejectArchiveFile</code> - Flag to specify if presence of any archive entry will cause the rejection of the ZIP file.</dd>
<dt>Returns:</dt>
<dd>True only if the file pass all validations.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://rules.sonarsource.com/java/type/Security%20Hotspot/RSPEC-5042"</li>
<li>"https://security.snyk.io/research/zip-slip-vulnerability"</li>
<li>"https://en.wikipedia.org/wiki/Zip_bomb"</li>
<li>"https://github.com/ptoomey3/evilarc"</li>
<li>"https://github.com/abdulfatir/ZipBomb"</li>
<li>"https://www.baeldung.com/cs/zip-bomb"</li>
<li>"https://thesecurityvault.com/attacks-with-zip-files-and-mitigations/"</li>
<li>"https://wiki.sei.cmu.edu/confluence/display/java/IDS04-J.+Safely+extract+files+from+ZipInputStream"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="identifyMimeType(byte[])">
<h3>identifyMimeType</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-460">identifyMimeType</a></span><wbr><span class="parameters">(byte[]&nbsp;content)</span></div>
<div class="block">Identify the mime type of the content specified (array of bytes).<br>
 Note that it cannot be fully trusted (see the tweet '1595824709186519041' referenced), so, additional validations are required.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>content</code> - The content as an array of bytes.</dd>
<dt>Returns:</dt>
<dd>The mime type in lower case or null if it cannot be identified.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://twitter.com/righettod/status/1595824709186519041"</li>
<li>"https://tika.apache.org/"</li>
<li>"https://mvnrepository.com/artifact/org.apache.tika/tika-core"</li>
<li>"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types"</li>
<li>"https://www.iana.org/assignments/media-types/media-types.xhtml"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isPublicIPAddress(java.lang.String)">
<h3>isPublicIPAddress</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-507">isPublicIPAddress</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;ip)</span></div>
<div class="block">Apply a collection of validations on a string expected to be an public IP address:<br>
 - Is a valid IP v4 or v6 address.<br>
 - Is public from an Internet perspective.<br><br>
 <b>Note:</b> I often see missing such validation in the value read from HTTP request headers like "X-Forwarded-For" or "Forwarded".
 <br>
 <b>Note for IPv6:</b> I used documentation found so it is really experimental!</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>ip</code> - String expected to be a valid IP address.</dd>
<dt>Returns:</dt>
<dd>True only if the string pass all validations.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://commons.apache.org/proper/commons-validator/"</li>
<li>"https://commons.apache.org/proper/commons-validator/apidocs/org/apache/commons/validator/routines/InetAddressValidator.html"</li>
<li>"https://cheatsheetseries.owasp.org/cheatsheets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html"</li>
<li>"https://cheatsheetseries.owasp.org/assets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet_Orange_Tsai_Talk.pdf"</li>
<li>"https://cheatsheetseries.owasp.org/assets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet_SSRF_Bible.pdf"</li>
<li>"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For"</li>
<li>"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Forwarded"</li>
<li>"https://ipcisco.com/lesson/ipv6-address/"</li>
<li>"https://www.juniper.net/documentation/us/en/software/junos/interfaces-security-devices/topics/topic-map/security-interface-ipv4-ipv6-protocol.html"</li>
<li>"https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/net/InetAddress.html#getByName(java.lang.String)"</li>
<li>"https://www.arin.net/reference/research/statistics/address_filters/"</li>
<li>"https://en.wikipedia.org/wiki/Multicast_address"</li>
<li>"https://stackoverflow.com/a/5619409"</li>
<li>"https://www.ripe.net/media/documents/ipv6-address-types.pdf"</li>
<li>"https://www.iana.org/assignments/ipv6-unicast-address-assignments/ipv6-unicast-address-assignments.xhtml"</li>
<li>"https://developer.android.com/reference/java/net/Inet6Address"</li>
<li>"https://en.wikipedia.org/wiki/Unique_local_address"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="computeHashNoProneToAbuseOnParts(java.util.List)">
<h3>computeHashNoProneToAbuseOnParts</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">byte[]</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-563">computeHashNoProneToAbuseOnParts</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;&nbsp;parts)</span>
                                               throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Exception.html" title="class or interface in java.lang" class="external-link">Exception</a></span></div>
<div class="block">Compute a SHA256 hash from an input composed of a collection of strings.<br><br>
 This method take care to build the source string in a way to prevent this source string to be prone to abuse targeting the different parts composing it.<br><br>
 Example of possible abuse without precautions applied during the hash calculation logic:<br>
 Hash of <code>SHA256("Hello", "My", "World!!!")</code> will be equals to the hash of <code>SHA256("Hell", "oMyW", "orld!!!")</code>.<br><br>
 This method ensure that both hash above will be different.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>parts</code> - Ordered list of strings to use to build the input string for which the hash must be computed on. No null value is accepted on object composing the collection.</dd>
<dt>Returns:</dt>
<dd>The hash, as an array of bytes, to allow caller to convert it to the final representation wanted (HEX, Base64, etc.). If the collection passed is null or empty then the method return null.</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Exception.html" title="class or interface in java.lang" class="external-link">Exception</a></code> - If any exception occurs</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://pentesterlab.com/badges/codereview"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isXMLOnlyUseAllowedXSDorDTD(java.lang.String,java.util.List)">
<h3>isXMLOnlyUseAllowedXSDorDTD</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-596">isXMLOnlyUseAllowedXSDorDTD</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;xmlFilePath,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;&nbsp;allowedSystemIdentifiers)</span></div>
<div class="block">Ensure that an XML file only uses DTD/XSD references (called System Identifier) present in the allowed list provided.<br><br>
 The code is based on the validation implemented into the OpenJDK 21, by the class <b><a href="https://github.com/openjdk/jdk/blob/jdk-21%2B35/src/java.prefs/share/classes/java/util/prefs/XmlSupport.java">java.util.prefs.XmlSupport</a></b>, in the method <b><a href="https://github.com/openjdk/jdk/blob/jdk-21%2B35/src/java.prefs/share/classes/java/util/prefs/XmlSupport.java#L240">loadPrefsDoc()</a></b>.<br><br>
 The method also ensure that no Public Identifier is used to prevent potential bypasses of the validations.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>xmlFilePath</code> - Filename of the XML file to check.</dd>
<dd><code>allowedSystemIdentifiers</code> - List of URL allowed for System Identifier specified for any XSD/DTD references.</dd>
<dt>Returns:</dt>
<dd>True only if the file pass all validations.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://www.w3schools.com/xml/prop_documenttype_systemid.asp"</li>
<li>"https://www.ibm.com/docs/en/integration-bus/9.0.0?topic=doctypedecl-xml-systemid"</li>
<li>"https://www.liquid-technologies.com/Reference/Glossary/XML_DocType.html"</li>
<li>"https://www.xml.com/pub/98/08/xmlqna0.html"</li>
<li>"https://github.com/openjdk/jdk/blob/jdk-21%2B35/src/java.prefs/share/classes/java/util/prefs/XmlSupport.java#L397"</li>
<li>"https://en.wikipedia.org/wiki/Formal_Public_Identifier"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isExcelCSVSafe(java.lang.String)">
<h3>isExcelCSVSafe</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-654">isExcelCSVSafe</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;csvFilePath)</span></div>
<div class="block">Apply a collection of validations on a EXCEL CSV file provided (file was expected to be opened in Microsoft EXCEL):<br>
 - Real CSV file.<br>
 - Do not contains any payload related to a CSV injections.<br><br>
 Ensure that, if Apache Commons CSV does not find any record then, the file will be considered as NOT safe (prevent potential bypasses).<br><br>
 <b>Note:</b> Record delimiter used is the <code>,</code> (comma) character. See the Apache Commons CSV reference provided for EXCEL.<br></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>csvFilePath</code> - Filename of the CSV file to check.</dd>
<dt>Returns:</dt>
<dd>True only if the file pass all validations.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://commons.apache.org/proper/commons-csv/"</li>
<li>"https://commons.apache.org/proper/commons-csv/apidocs/org/apache/commons/csv/CSVFormat.html#EXCEL"</li>
<li>"https://www.we45.com/post/your-excel-sheets-are-not-safe-heres-how-to-beat-csv-injection"</li>
<li>"https://www.whiteoaksecurity.com/blog/2020-4-23-csv-injection-whats-the-risk/"</li>
<li>"https://book.hacktricks.xyz/pentesting-web/formula-csv-doc-latex-ghostscript-injection"</li>
<li>"https://owasp.org/www-community/attacks/CSV_Injection"</li>
<li>"https://payatu.com/blog/csv-injection-basic-to-exploit/"</li>
<li>"https://cwe.mitre.org/data/definitions/1236.html"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="ensureSerializedObjectIntegrity(eu.righettod.ProcessingMode,java.lang.String,byte[])">
<h3>ensureSerializedObjectIntegrity</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&gt;</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-698">ensureSerializedObjectIntegrity</a></span><wbr><span class="parameters">(<a href="ProcessingMode.html" title="enum class in eu.righettod">ProcessingMode</a>&nbsp;processingMode,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;input,
 byte[]&nbsp;secret)</span>
                                                          throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Exception.html" title="class or interface in java.lang" class="external-link">Exception</a></span></div>
<div class="block">Provide a way to add an integrity marker (<a href="https://en.wikipedia.org/wiki/HMAC">HMAC</a>) to a serialized object serialized using the <a href="https://www.baeldung.com/java-serialization">java native system</a> (binary).<br>
 The goal is to provide <b>a temporary workaround</b> to try to prevent deserialization attacks and give time to move to a text-based serialization approach.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>processingMode</code> - Define the mode of processing i.e. protect or validate. (<a href="ProcessingMode.html" title="enum class in eu.righettod"><code>ProcessingMode</code></a>)</dd>
<dd><code>input</code> - When the processing mode is "protect" than the expected input (string) is a java serialized object encoded in Base64 otherwise (processing mode is "validate") expected input is the output of this method when the "protect" mode was used.</dd>
<dd><code>secret</code> - Secret to use to compute the SHA256 HMAC.</dd>
<dt>Returns:</dt>
<dd>A map with the following keys: <ul><li><b>PROCESSING_MODE</b>: Processing mode used to compute the result.</li><li><b>STATUS</b>: A boolean indicating if the processing was successful or not.</li><li><b>RESULT</b>: Always contains a string representing the protected serialized object in the format <code>[SERIALIZED_OBJECT_BASE64_ENCODED]:[SERIALIZED_OBJECT_HMAC_BASE64_ENCODED]</code>.</li></ul></dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Exception.html" title="class or interface in java.lang" class="external-link">Exception</a></code> - If any exception occurs.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html"</li>
<li>"https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization"</li>
<li>"https://portswigger.net/web-security/deserialization"</li>
<li>"https://www.baeldung.com/java-serialization-approaches"</li>
<li>"https://www.baeldung.com/java-serialization"</li>
<li>"https://cryptobook.nakov.com/mac-and-key-derivation/hmac-and-key-derivation"</li>
<li>"https://en.wikipedia.org/wiki/HMAC"</li>
<li>"https://smattme.com/posts/how-to-generate-hmac-signature-in-java/"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isJSONSafe(java.lang.String,int,int)">
<h3>isJSONSafe</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-771">isJSONSafe</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;json,
 int&nbsp;maxItemsByArraysCount,
 int&nbsp;maxDeepnessAllowed)</span></div>
<div class="block">Apply a collection of validations on a JSON string provided:<br>
 - Real JSON structure.<br>
 - Contain less than a specified number of deepness for nested objects or arrays.<br>
 - Contain less than a specified number of items in any arrays.<br><br>

 <b>Note:</b> I decided to use a parsing approach using only string processing to prevent any StackOverFlow or OutOfMemory error that can be abused.<br><br>
 I used the following assumption:
 <ul>
      <li>The character <code>{</code> identify the beginning of an object.</li>
      <li>The character <code>}</code> identify the end of an object.</li>
      <li>The character <code>[</code> identify the beginning of an array.</li>
      <li>The character <code>]</code> identify the end of an array.</li>
      <li>The character <code>"</code> identify the delimiter of a string.</li>
      <li>The character sequence <code>\"</code> identify the escaping of an double quote.</li>
 </ul></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>json</code> - String containing the JSON data to validate.</dd>
<dd><code>maxItemsByArraysCount</code> - Maximum number of items allowed in an array.</dd>
<dd><code>maxDeepnessAllowed</code> - Maximum number nested objects or arrays allowed.</dd>
<dt>Returns:</dt>
<dd>True only if the string pass all validations.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://javaee.github.io/jsonp/"</li>
<li>"https://community.f5.com/discussions/technicalforum/disable-buffer-overflow-in-json-parameters/124306"</li>
<li>"https://github.com/InductiveComputerScience/pbJson/issues/2"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isImageSafe(java.lang.String,java.util.List)">
<h3>isImageSafe</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-880">isImageSafe</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;imageFilePath,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/List.html" title="class or interface in java.util" class="external-link">List</a>&lt;<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&gt;&nbsp;imageAllowedMimeTypes)</span></div>
<div class="block">Apply a collection of validations on a image file provided:<br>
 - Real image file.<br>
 - Its mime type is into the list of allowed mime types.<br>
 - Its metadata fields do not contains any characters related to a malicious payloads.<br>

 <br>
 <b>Important note:</b> This implementation is prone to bypass using the "<b>raw insertion</b>" method documented in the <a href="https://www.synacktiv.com/en/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there">blog post</a> from the Synacktiv team.
 To handle such case, it is recommended to resize the image to remove any non image-related content, see <a href="https://github.com/righettod/document-upload-protection/blob/master/src/main/java/eu/righettod/poc/sanitizer/ImageDocumentSanitizerImpl.java#L54">here</a> for an example.<br></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>imageFilePath</code> - Filename of the image file to check.</dd>
<dd><code>imageAllowedMimeTypes</code> - List of image mime types allowed.</dd>
<dt>Returns:</dt>
<dd>True only if the file pass all validations.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://commons.apache.org/proper/commons-imaging/"</li>
<li>"https://commons.apache.org/proper/commons-imaging/formatsupport.html"</li>
<li>"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types"</li>
<li>"https://www.iana.org/assignments/media-types/media-types.xhtml#image"</li>
<li>"https://www.synacktiv.com/en/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there"</li>
<li>"https://cheatsheetseries.owasp.org/cheatsheets/File_Upload_Cheat_Sheet.html"</li>
<li>"https://github.com/righettod/document-upload-protection/blob/master/src/main/java/eu/righettod/poc/sanitizer/ImageDocumentSanitizerImpl.java"</li>
<li>"https://exiftool.org/examples.html"</li>
<li>"https://en.wikipedia.org/wiki/List_of_file_signatures"</li>
<li>"https://hexed.it/"</li>
<li>"https://github.com/sighook/pixload"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="sanitizeFile(java.lang.String,eu.righettod.InputFileType)">
<h3>sanitizeFile</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">byte[]</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-928">sanitizeFile</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;inputFilePath,
 <a href="InputFileType.html" title="enum class in eu.righettod">InputFileType</a>&nbsp;inputFileType)</span>
                           throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Exception.html" title="class or interface in java.lang" class="external-link">Exception</a></span></div>
<div class="block">Rewrite the input file to remove any embedded files that is not embedded using a methods supported by the official format of the file.<br>
 Example: a file can be embedded by adding it to the end of the source file, see the reference provided for details.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>inputFilePath</code> - Filename of the file to clean up.</dd>
<dd><code>inputFileType</code> - Type of the file provided.</dd>
<dt>Returns:</dt>
<dd>A array of bytes with the cleaned file.</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - If an invalid parameter is passed</dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Exception.html" title="class or interface in java.lang" class="external-link">Exception</a></code> - If any technical error during the cleaning processing</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://www.synacktiv.com/en/publications/persistent-php-payloads-in-pngs-how-to-inject-php-code-in-an-image-and-keep-it-there"</li>
<li>"https://github.com/righettod/toolbox-pentest-web/tree/master/misc"</li>
<li>"https://github.com/righettod/toolbox-pentest-web?tab=readme-ov-file#misc"</li>
<li>"https://stackoverflow.com/a/13605411"</li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="isEmailAddress(java.lang.String)">
<h3>isEmailAddress</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">boolean</span>&nbsp;<span class="element-name"><a href="../../src-html/eu/righettod/SecurityUtils.html#line-997">isEmailAddress</a></span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;addr)</span></div>
<div class="block">Apply a collection of validations on a string expected to be an email address:<br>
 - Is a valid email address, from a parser perspective, following RFCs on email addresses.<br>
 - Is not using "Encoded-word" format.<br>
 - Is not using comment format.<br>
 - Is not using "Punycode" format.<br>
 - Is not using UUCP style addresses.<br>
 - Is not using address literals.<br>
 - Is not using source routes.<br>
 - Is not using the "percent hack".<br><br>
 This is based on the research work from <a href="https://portswigger.net/research/gareth-heyes">Gareth Heyes</a> added in references (Portswigger).<br><br>

 <b>Note:</b> The notion of valid, here, is to take from a secure usage of the data perspective.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>addr</code> - String expected to be a valid email address.</dd>
<dt>Returns:</dt>
<dd>True only if the string pass all validations.</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li>"https://commons.apache.org/proper/commons-validator/"</li>
<li>"https://commons.apache.org/proper/commons-validator/apidocs/org/apache/commons/validator/routines/EmailValidator.html"</li>
<li>"https://datatracker.ietf.org/doc/html/rfc2047#section-2"</li>
<li>"https://portswigger.net/research/splitting-the-email-atom"</li>
<li>"https://www.jochentopf.com/email/address.html"</li>
<li>"https://en.wikipedia.org/wiki/Email_address"</li>
</ul>
</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>code-snippets-security-utils - 1.0.0-SNAPSHOT</small></p>
</footer>
</div>
</div>
</body>
</html>
